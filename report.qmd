---
title: "Project title"
subtitle: "Report"
format: html
editor: visual
execute:
  echo: true
---

**Research Project: International Crime** Research Question:

**Has the world become more violent in the past 15 years (2005-2020), both worldwide and regionally?**

**How does sex factor into the results?**

**How do these rates correlate with regional and national GDPs?**

**Insertion of Data:**

```{r}

library(tidyverse)
library(tidymodels)
replaceCommas<-function(x){
  x<-as.numeric(gsub("\\,", "", x))}
gdp_un <- read.csv("data/GDP_GDPpC_UN_Altered.csv", header=TRUE, na.strings = ",")
gdp_un <- gdp_un |>
  rename("SeriesGDP" = "Series", "ValueGDP" = "Value", "FootnotesGDP" = "Footnotes", "XGDP" = "X", "Region.Country.Area.GDP" = "Region.Country.Area")
gdp_un$ValueGDP <- replaceCommas(gdp_un$ValueGDP)
gdp_un$ValueGDP <- as.numeric(as.character(gdp_un$ValueGDP))

homicides_and_crime_un <- read.csv("data/Homicides_Other_Crimes_UN_Altered.csv", header=TRUE)
homicides_and_crime_un$Value <- as.numeric(as.character(homicides_and_crime_un$Value))
```

**EXAMPLE FOR GETTING DATA FOR REGRESSION**

```{r}
#setting up GDP
gdp_un_total <- gdp_un |>
  filter(Region.Country.Area.GDP == "1") |> #region of interest
  filter(SeriesGDP == "GDP in current prices (millions of US dollars)") #statistic of interest
gdp_un_total$ValueGDP <- as.numeric(as.character(gdp_un_total$ValueGDP))

#setting up Crime
homicides_and_crime_un_total <- homicides_and_crime_un |>
  filter(Region.Country.Area == "1") |> #region of interest
  filter(Series == "Intentional homicide rates per 100,000") #statistic of interest

#Joining them
gdp_current_and_crime_total <- homicides_and_crime_un_total |> 
full_join(gdp_un_total, by = "Year") |> #always by Year
  filter(!is.na(Region.Country.Area)) #dropping NAs
```

**R-Squared of Data Set (Total EXAMPLE)**

modeltotal \<- linear_reg() \|\>

set_engine("lm") \|\>

fit(ValueGDP \~ Value, data = gdp_current_and_crime_total)

glance(modeltotal)\$r.squared

```{r}

modeltotal <- linear_reg() |>
  set_engine("lm") |>
  fit(ValueGDP ~ Value, data = gdp_current_and_crime_total)

glance(modeltotal)$r.squared
```

**Total Linear Regression Model (With GDP) (EXAMPLE):**

```{r}

model_total <- linear_reg() |>
  set_engine("lm") |>
  fit(ValueGDP ~ Value, data = gdp_current_and_crime_total)
```

**Has the world become more violent in the past 15 years (2005-2020), both worldwide and regionally, based on sex?**

Regional Regressions

```{r}
#| label: africa-regression&r2
gdp_un_africa <- gdp_un |>
  filter(Region.Country.Area.GDP == "2") |> 
  filter(SeriesGDP == "GDP in current prices (millions of US dollars)") 

gdp_un_africa$ValueGDP <- as.numeric(as.character(gdp_un_africa$ValueGDP))

homicides_and_crime_un_africa <- homicides_and_crime_un |>
  filter(Region.Country.Area == "2") |> 
  filter(Series == "Intentional homicide rates per 100,000")

gdp_current_and_crime_africa <- homicides_and_crime_un_africa |> 
full_join(gdp_un_africa, by = "Year") |>
  filter(!is.na(Region.Country.Area))

modelafrica <- linear_reg() |>
  set_engine("lm") |>
  fit(ValueGDP ~ Value, data = gdp_current_and_crime_africa)

glance(modelafrica)$r.squared
```

1.  Worldwide violence, based on sex: **(FIXED, EXAMPLE)**

```{r}
#| label: worldwide-violence-sex

homicides_and_crime_un_sex <- homicides_and_crime_un |>
  filter(Region.Country.Area == "1") |> #region of interest
  mutate(sex = if_else(str_detect(Series, "Male"), "Male", "Female")) |> #not used elsewhere
  filter(Series != "Intentional homicide rates per 100,000") #statistic of interest, watch the != vs == for what you want
 

homicides_and_crime_un_sex |> #most of this straight forward, make sure to include correct titling/subtitles and caption it
  group_by(sex) |>
  ggplot(aes(x = Year, y = Value, color = sex)) +
  geom_line() +
  geom_point() + 
  labs(
    x = "Year",
    y = "# of International Homicide Victims (per 100,000 persons)",
    title = "International Homicide Victims* by Sex",
    fill = "Sex", subtitle = "Rate per 100,000 (of given sex's population)",
    caption = "*Homicides are defined as intentional homicides by this dataset")
```

2.  Regional Violence, General:

```{r}
#| label: Africa

Africa_homicides_and_crime_un <- homicides_and_crime_un |>
  filter(X == "Africa") 

Africa_homicides_and_crime_un |>
  ggplot(aes(x = Year, y = Value, group = 1)) +
  geom_line() +
  geom_point() + 
  labs(
    x = "Year",
    y = "% Homicide Victims Per 100k",
    title = "Intentional Homicide Victims in Africa"
  )

```

```{r}
#| label: Northern-America

NAmerica_homicides_and_crime_un <- homicides_and_crime_un |>
  filter(X == "Northern America") |>
  mutate(
    sex = if_else(
      str_detect(Series, "Male"), "Male", "Female")
    ) |>
  filter(Series == "Intentional homicide rates per 100,000")

NAmerica_homicides_and_crime_un |>
  ggplot(aes(x = Year, y = Value, group = 1)) +
  geom_line() +
  geom_point() + 
  labs(
    x = "Year",
    y = "% Homicide Victims Per 100k",
    title = "Intentional Homicide Victims in N. America"
  )

```

```{r}
#| label: LA-And-Caribbean

LACarib_homicides_and_crime_un <- homicides_and_crime_un |>
  filter(X == "Latin America & the Caribbean") |>
  mutate(
    sex = if_else(
      str_detect(Series, "Male"), "Male", "Female")
    ) |>
  filter(Series == "Intentional homicide rates per 100,000")

LACarib_homicides_and_crime_un |>
  ggplot(aes(x = Year, y = Value, group = 1)) +
  geom_line() +
  geom_point() + 
  labs(
    x = "Year",
    y = "% Homicide Victims Per 100k",
    title = "Intentional Homicide Victims in Latin America and the Caribbean"
  )
```

```{r}
#| label: Asia

Asia_homicides_and_crime_un <- homicides_and_crime_un |>
  filter(X == "Asia") |>
  mutate(
    sex = if_else(
      str_detect(Series, "Male"), "Male", "Female")
    ) |>
  filter(Series == "Intentional homicide rates per 100,000")

Asia_homicides_and_crime_un |>
  ggplot(aes(x = Year, y = Value, group = 1)) +
  geom_line() +
  geom_point() + 
  labs(
    x = "Year",
    y = "% Homicide Victims Per 100k",
    title = "Intentional Homicide Victims in Asia"
  )
```

```{r}
#| label: Europe

Europe_homicides_and_crime_un <- homicides_and_crime_un |>
  filter(X == "Europe") |>
  mutate(
    sex = if_else(
      str_detect(Series, "Male"), "Male", "Female")
    ) |>
  filter(Series == "Intentional homicide rates per 100,000")

Europe_homicides_and_crime_un |>
  ggplot(aes(x = Year, y = Value, group = 1)) +
  geom_line() +
  geom_point() + 
  labs(
    x = "Year",
    y = "% Homicide Victims Per 100k",
    title = "Intentional Homicide Victims in Europe"
  )
```

```{r}
#| label: Oceania

Oceania_homicides_and_crime_un <- homicides_and_crime_un |>
  filter(X == "Oceania") |>
   mutate(
    sex = if_else(
      str_detect(Series, "Male"), "Male", "Female")
    ) |>
  filter(Series == "Intentional homicide rates per 100,000")

Oceania_homicides_and_crime_un |>
  ggplot(aes(x = Year, y = Value, group = 1)) +
  geom_line() +
  geom_point() + 
  labs(
    x = "Year",
    y = "% Homicide Victims Per 100k",
    title = "Intentional Homicide Victims in Oceania"
  )
```

**TBD:**

Regional Regressions

Graph Modifications/Tidying up -- Make em' colorful and nice :)

**Results:**
